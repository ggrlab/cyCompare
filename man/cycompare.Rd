% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cycompare.R
\name{cycompare}
\alias{cycompare}
\title{Compare Flow Cytometry Data Across Devices}
\usage{
cycompare(
  flowframes,
  df,
  ff_columns_relevant,
  dfcol_grouping_supersamples = NULL,
  dfcol_grouping_samples = "Device",
  dfcol_train_validation_other = "train_validation_test",
  transformlist = function(x) asinh(x/1000),
  gatingsets,
  gatename_primary,
  n_events_postgate = 10000,
  postgate_sample_seed = 42,
  marker_to_gate,
  prepared_saveload = FALSE,
  device_colors = function(n) {
     RColorBrewer::brewer.pal(n, "Dark2")
 },
  do_otd = TRUE,
  OTD_kwargs_loss = list(loss = lossfun_hist, verbose = FALSE, write_intermediate =
    FALSE, should_skip = function(i, j) FALSE, take_time = FALSE, return_as_matrix =
    TRUE),
  do_flowsom = TRUE,
  nClus = 5,
  scale = FALSE,
  xdim = 3,
  ydim = 3,
  flowsom_seed = 3711283
)
}
\arguments{
\item{flowframes}{Named list of \code{flowFrame} objects with raw flow cytometry data. Names must match entries in \code{df$File}.}

\item{df}{A \code{data.table} containing sample metadata. Must include columns specified by \verb{dfcol_*}
and a unique \code{File} column linking to \code{names(flowframes)}..}

\item{ff_columns_relevant}{Character vector of marker/feature columns to use for clustering and modeling.}

\item{dfcol_grouping_supersamples}{Column(s) in \code{df} used to define supersample groupings (e.g., \code{"Study"}).
A supersample collects samples of same origin: A study collects samples from
multiple donors/patients, a patient might be in multiple times.}

\item{dfcol_grouping_samples}{Column in \code{df} that defines sample-level grouping (e.g., \code{"Device"}).
Each final biologically different sample could be measured with a different technology,
cytometer, or lab but SHOULD have the same values.}

\item{dfcol_train_validation_other}{Column indicating sample usage role: \code{"train"}, \code{"test"}, etc.}

\item{transformlist}{Either a function (applied as \code{flowCore::transformlist}) or a \code{transformlist} object.
Default: \code{asinh(x / 1e3)}.}

\item{gatingsets}{Named list of gating sets used to extract primary populations. One gating set per sample.}

\item{gatename_primary}{String specifying the gate used for downstream data (e.g., \code{"CD3+"}).}

\item{n_events_postgate}{Maximum number of events to retain per sample after gating (default: 10,000).}

\item{postgate_sample_seed}{Integer seed used for reproducible post-gating subsampling (default: 42).}

\item{marker_to_gate}{Named vector mapping markers to their respective gate names.}

\item{prepared_saveload}{Optional character path. If the file exists, will load preprocessed data with \code{qs::qread()};
if not, will save it after processing using \code{qs::qsave()}.}

\item{device_colors}{Either a named vector or a function returning colors for each device.}

\item{do_otd}{Logical. Whether to perform optimal transport distance (OTD) comparison (default: \code{TRUE}).}

\item{OTD_kwargs_loss}{Named list of arguments for the OTD loss function.}

\item{do_flowsom}{Logical. Whether to perform FlowSOM clustering and plot comparisons (default: \code{TRUE}).}

\item{nClus}{Number of clusters for FlowSOM (default: 5).}

\item{scale}{Logical, whether to scale markers for FlowSOM (default: \code{FALSE}).}

\item{xdim}{An integer specifying the x-dimension of the FlowSOM grid (default: 3).}

\item{ydim}{An integer specifying the y-dimension of the FlowSOM grid (default: 3).}

\item{flowsom_seed}{An integer specifying the random seed for FlowSOM clustering (default: \code{3711283}).}

\item{...}{Passed to \code{plot_flowsom()} (e.g., plotting customization).}
}
\value{
A named list of \code{ggplot2} plots:
\describe{
\item{Samples over time per device}{Number of samples per device over time.}
\item{Counts and percentages}{Per-sample cell counts and gated proportions.}
\item{Positive population MFI}{MFI values of gated markers across devices.}
\item{Positive population MFI ratio}{Ratio of MFI values across devices.}
\item{Density plots}{Marker intensity distributions for each device.}
\item{OTD to mastersample}{Pairwise distances between devices or conditions.}
\item{Flowsom_PCA}{Cluster-level PCA across samples.}
\item{Flowsom_MA}{Mean-vs-difference cluster abundance plots.}
}
}
\description{
Performs a standardized cross-device comparison pipeline for flow cytometry data.
This includes gating, marker transformation, FlowSOM clustering, density and MFI plots,
and optionally optimal transport distance (OTD) analysis. Can save or load preprocessed data for efficiency.
}
