% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cycompare_outcomes_analyse.R
\name{cycompare_outcomes_analyse}
\alias{cycompare_outcomes_analyse}
\title{Core Analysis Pipeline for Flow Cytometry Outcomes Across Devices}
\usage{
cycompare_outcomes_analyse(
  flowframes,
  df,
  ff_columns_relevant,
  dfcol_grouping_supersamples = c("Study"),
  dfcol_grouping_samples = "Device",
  dfcol_train_validation_other = "tvt",
  dfcol_outcomes = c("outcome_1", "outcome_2"),
  outcome_models = list(glmnet = glmnet::cv.glmnet),
  outdir_base = tempdir(),
  transformlist = function(x) asinh(x/1000),
  gatingsets,
  gatename_primary,
  n_events_postgate = 10000,
  marker_to_gate,
  device_colors = function(n) {
     RColorBrewer::brewer.pal(n, "Dark2")
 },
  clustering_n_subsampling = 1,
  clustering_n_subsampled_cells = 10000,
  clustering_subsampling_seed_first = 42,
  kwargs_flowsom = list(nClus = 5, scale = FALSE, xdim = 3, ydim = 3, seed = 3711283),
  kwargs_modelling = list(hparam_n_evaluations = 3, seed = 42, learners_classification =
    list(mlr3::lrn("classif.ranger", predict_type = "prob", predict_sets = c("train",
    "test"), max.depth = paradox::to_tune(2, 20), num.trees = paradox::to_tune(c(500,
    1000, 1500, 2000)), importance = "impurity")), loss_measure =
    mlr3::msr("classif.logloss")),
  model_counts_proportions = c("counts", "proportions"),
  model_which_elements = c("metaCluster"),
  dv_class_positive = c(outcome_1 = "A", outcome_2 = 5.1),
  prepared_saveload = FALSE,
  postgate_sample_seed = 42
)
}
\arguments{
\item{flowframes}{Named list of \code{flowFrame} objects with raw flow cytometry data. Names must match entries in \code{df$File}.}

\item{df}{A \code{data.table} containing sample metadata. Must include columns specified by \verb{dfcol_*}
and a unique \code{File} column linking to \code{names(flowframes)}..}

\item{ff_columns_relevant}{Character vector of marker/feature columns to use for clustering and modeling.}

\item{dfcol_grouping_supersamples}{Column(s) in \code{df} used to define supersample groupings (e.g., \code{"Study"}).
A supersample collects samples of same origin: A study collects samples from
multiple donors/patients, a patient might be in multiple times.}

\item{dfcol_grouping_samples}{Column in \code{df} that defines sample-level grouping (e.g., \code{"Device"}).
Each final biologically different sample could be measured with a different technology,
cytometer, or lab but SHOULD have the same values.}

\item{dfcol_train_validation_other}{Column indicating sample usage role: \code{"train"}, \code{"test"}, etc.}

\item{dfcol_outcomes}{Character vector of outcome column names to model (e.g., \code{c("outcome_1", "outcome_2")}).}

\item{outcome_models}{Named list of modeling functions. Defaults to \code{cv.glmnet}.}

\item{outdir_base}{Base directory for saving intermediate results (default: \code{tempdir()}).}

\item{transformlist}{Either a function (applied as \code{flowCore::transformList}) or a \code{transformlist} object.
Default: \code{asinh(x / 1e3)}.}

\item{gatingsets}{Named list of gating sets used to extract primary populations. One gating set per sample.}

\item{gatename_primary}{String specifying the gate used for downstream data (e.g., \code{"CD3+"}).}

\item{n_events_postgate}{Maximum number of events to retain per sample after gating (default: 10,000).}

\item{marker_to_gate}{Named vector mapping markers to their respective gate names.}

\item{device_colors}{Either a named vector or a function returning colors for each device.}

\item{clustering_n_subsampling}{Number of FlowSOM subsampling repeats (default: 1).}

\item{clustering_n_subsampled_cells}{Number of cells per sample to use per subsample (default: 10,000).}

\item{clustering_subsampling_seed_first}{Seed for the first clustering repeat (default: 42).}

\item{kwargs_flowsom}{Named list of FlowSOM parameters (e.g., \code{nClus}, \code{xdim}, \code{ydim}, \code{seed}, etc.).}

\item{kwargs_modelling}{Named list of modeling parameters (e.g., learners, tuning, loss function).}

\item{dv_class_positive}{Named vector specifying the positive class for each outcome (e.g., \code{c("outcome_1" = "A", "outcome_2" = 5.1)}).}
}
\value{
A named list with the following structure:
\describe{
\item{prepared_data}{Transformed flowFrames, cell counts, and device colors.}
\item{clustering}{FlowSOM models trained on training data and applied to all samples.}
\item{models}{
Trained models according to \code{dfcol_train_validation_other} splits
and their predictions across all samples.
}
}
}
\description{
Performs a full pipeline for outcome prediction across multiple flow cytometry devices.
This includes data preprocessing (gating, transformation), FlowSOM clustering, and outcome modeling.
The function returns results that can be directly used for downstream statistical analysis or plotting.
}
