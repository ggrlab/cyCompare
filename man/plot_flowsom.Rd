% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_flowsom.R
\name{plot_flowsom}
\alias{plot_flowsom}
\title{Perform FlowSOM Clustering and Generate Device-Comparative Plots}
\usage{
plot_flowsom(
  ff_gated,
  df,
  device_colors = NULL,
  transformlist,
  nClus = 5,
  scale = FALSE,
  xdim = 3,
  ydim = 3,
  seed = 3711283,
  dfcol_grouping_samples = "Device",
  dfcol_train_validation_other = NULL,
  MA_horizontal_lines_FC = c(2, 10, 25),
  MA_bins = 100
)
}
\arguments{
\item{ff_gated}{A list of \code{flowFrame} objects containing gated flow cytometry data.}

\item{df}{A \code{data.table} with metadata, containing at least the columns \code{"File"},
\code{dfcol_grouping_samples}, and \code{"Sample"}.}

\item{device_colors}{A named vector assigning a color to each device. Used in plots.}

\item{transformlist}{A list of transformation functions per marker. If a single function is given, it is applied to all markers.}

\item{nClus}{Integer specifying the number of clusters for FlowSOM.}

\item{scale}{Logical. If \code{TRUE}, scales the data before clustering.}

\item{xdim}{Integer. X-dimension of the FlowSOM grid.}

\item{ydim}{Integer. Y-dimension of the FlowSOM grid.}

\item{seed}{Integer. Random seed for reproducibility.}

\item{dfcol_grouping_samples}{Character scalar specifying the column in \code{df} used to group samples in PCA plots (default: \code{"Device"}).}

\item{dfcol_train_validation_other}{Optional character scalar. If set, this column is used to select the training subset
(\code{"train"}) for clustering and to shape/facet the plots.}
}
\value{
A named list with two elements:
\item{plots_pca}{A list of PCA plots showing clustering results colored by device.}
\item{p_MA}{A list of MA plots comparing cluster proportions across devices.}
}
\description{
This function clusters gated flow cytometry data using FlowSOM and generates PCA and MA plots
to compare cluster distributions across devices. Optionally, only a training subset of the data
can be used for clustering.
}
\examples{
# Simulate flow cytometry data
fs <- cytobench::simulate_fs(
    n_samples = 4,
    ncells = 250,
    columns = c("CD4", "CD8", "CD3")
)

# Create metadata for each sample
df_meta <- data.table::data.table(
    File = flowCore::sampleNames(fs),
    Device = c("A", "A", "B", "B"),
    Sample = c("S1", "S2", "S1", "S2"),
    SuperSample = "Study_Z",
    TrainTest = c("train", "test", "train", "test")
)

# Define color palette for devices
device_cols <- c("A" = "steelblue", "B" = "firebrick")

# Run FlowSOM clustering and generate plots
result <- plot_flowsom(
    ff_gated = fs,
    df = df_meta,
    device_colors = device_cols,
    transformlist = function(x) asinh(x / 1000),
    nClus = 4,
    dfcol_grouping_samples = "Device",
    dfcol_train_validation_other = "TrainTest"
)

# Show first PCA plot
print(result$plots_pca)

# Show first MA plot (first device combination, first clustering)
print(result$p_MA)
}
