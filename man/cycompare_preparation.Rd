% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cycompare_preparation.R
\name{cycompare_preparation}
\alias{cycompare_preparation}
\title{Prepare Gated FlowFrames and Metadata for Cross-Device Comparison}
\usage{
cycompare_preparation(
  flowframes,
  df,
  ff_columns_relevant,
  device_colors = function(n) {
     RColorBrewer::brewer.pal(n, "Dark2")
 },
  gatingsets,
  gatename_primary,
  n_events_postgate = 10000,
  marker_to_gate = NULL,
  seed = 42,
  dfcol_grouping_supersamples = c("Study"),
  dfcol_grouping_samples = "Device",
  dfcol_train_validation_other = NULL,
  transformlist = NULL
)
}
\arguments{
\item{flowframes}{Named list of \code{flowFrame} objects with raw flow cytometry data. Names must match entries in \code{df$File}.}

\item{df}{A \code{data.table} containing sample metadata. Must include columns specified by \verb{dfcol_*}
and a unique \code{File} column linking to \code{names(flowframes)}..}

\item{ff_columns_relevant}{Character vector of marker/feature columns to use for clustering and modeling.}

\item{device_colors}{Either a named vector or a function returning colors for each device.}

\item{gatingsets}{Named list of gating sets used to extract primary populations. One gating set per sample.}

\item{gatename_primary}{String specifying the gate used for downstream data (e.g., \code{"CD3+"}).}

\item{n_events_postgate}{Maximum number of events to retain per sample after gating (default: 10,000).}

\item{marker_to_gate}{Named vector mapping markers to their associated gate name.
Later used for plotting.}

\item{seed}{Integer.
Random seed for reproducibility during subsampling. Default is 42.}

\item{dfcol_grouping_supersamples}{Column(s) in \code{df} used to define supersample groupings (e.g., \code{"Study"}).
A supersample collects samples of same origin: A study collects samples from
multiple donors/patients, a patient might be in multiple times.}

\item{dfcol_grouping_samples}{Column in \code{df} that defines sample-level grouping (e.g., \code{"Device"}).
Each final biologically different sample could be measured with a different technology,
cytometer, or lab but SHOULD have the same values.}

\item{dfcol_train_validation_other}{Column indicating sample usage role: \code{"train"}, \code{"test"}, etc.}

\item{transformlist}{A named list or function defining transformations for \code{ff_columns_relevant}.
All markers listed must be present. If provided as a function or unnamed list, it is recycled.}
}
\value{
A named list with the following elements:
\describe{
\item{gated_ff}{Named list of gated and downsampled \code{flowFrame}s, reduced to \code{ff_columns_relevant}.}
\item{counts_joint}{Merged \code{data.table} combining per-sample cell counts (from gating) and metadata (\code{df}).}
\item{device_colors}{Named vector of device color assignments. Auto-generated if not provided explicitly.}
\item{marker_to_gate}{The (possibly adjusted) mapping from markers to gates used during validation.}
\item{gatename_primary}{Name of the gate used to subset events (typically \code{"Live"} or \code{"CD3+"}).}
}
}
\description{
Applies a primary gating step to flow cytometry samples, assigns colors to devices,
and returns gated data and metadata for downstream clustering, modeling, or plotting.
}
