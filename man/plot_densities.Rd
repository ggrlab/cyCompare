% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_densities.R
\name{plot_densities}
\alias{plot_densities}
\title{Plot Density Distributions for Gated Flow Cytometry Data}
\usage{
plot_densities(
  ff_gated,
  df,
  device_colors,
  transformlist = NULL,
  density_n = 500,
  dfcol_grouping_samples = "Device",
  relevant_columns = NULL,
  limit_density_quantile = NA
)
}
\arguments{
\item{ff_gated}{Named list of \code{flowFrame} objects, each representing gated flow cytometry data for one sample.
Names must correspond to entries in \code{df$File}. Can be a flowset or a named list of flowFrames.}

\item{df}{A \code{data.table} containing metadata for samples. Must include \code{"File"}, \code{dfcol_grouping_samples}, and \code{"Sample"} columns.}

\item{device_colors}{Optional named vector of colors for each device (e.g., \code{c("Fortessa" = "blue", "Aurora" = "red")}).}

\item{transformlist}{Either a single transformation function or a named list of functions, one per marker.
If NULL, no transformation is applied.}

\item{density_n}{Integer; number of points for kernel density estimation (default: 500).}

\item{dfcol_grouping_samples}{Column name (character) in \code{df} used for device/sample grouping (default: \code{"Device"}).}

\item{relevant_columns}{Character vector of markers to include in the plot. If NULL, all markers are included.}

\item{limit_density_quantile}{Numeric between 0 and 1; limits plotted densities to a quantile threshold (e.g., 0.95).
Useful to suppress extreme density peaks which make all other densities barely visible.
Set to \code{NA} to disable.}
}
\value{
A \code{ggplot2} object showing density curves across markers, devices, and samples.
}
\description{
This function generates density plots for multiple flow cytometry markers across different devices and samples.
It applies optional transformations, merges metadata, and creates a faceted plot of density curves.
}
\details{
Every (unique!) flowframe must have a unique name present in \code{df$File}, which will be
matched to the \code{"Sample"} column. One sample would often (not necessarily!)
correspond to multiple flowframes, e.g., if multiple files were acquired
for the same sample on multiple devices.
}
\examples{
fs <- cytobench::simulate_fs(n_samples = 3, ncells = 250, columns = c("CD4", "CD8"))

# Metadata
df_meta <- data.table::data.table(
    File = flowCore::sampleNames(fs),
    Device = c("A", "B", "A"),
    Sample = c("S1", "S2", "S2")
)

# Colors for devices
device_cols <- c("A" = "steelblue", "B" = "firebrick")

# Apply density plot function
plot <- plot_densities(
    ff_gated = fs,
    df = df_meta,
    device_colors = device_cols,
    transformlist = function(x) asinh(x / 1000),
    relevant_columns = c("CD4", "CD8")
)

# Show plot
print(plot)
}
